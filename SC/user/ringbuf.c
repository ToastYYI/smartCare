/* 引用头文件 *****************************************************************/
#include "ringbuf.h"
/* 私有数据类型 ***************************************************************/
/* 私有常数宏 *****************************************************************/
/* 私有动作宏 *****************************************************************/
/* 私有变量 *******************************************************************/
/* 全局变量 */
/* 私有函数声明 ***************************************************************/
/* 私有函数  ******************************************************************/
//int RingbufInit(struct Stdringbuf_n* r, uint8_t array[], uint8_t len) {
//    if (len < 2 || array==NULL){
//        return false;
//    }
//   // r->buf = array;
//    r->length = len;
//    r->fill_cnt = 0;
//    r->head = r->tail = 0;
//    return true;
//}

//int RingbufPut(struct Stdringbuf_n* r, uint8_t data) {
//    //当tail+1等于head时，说明队列已满
//    if (r->fill_cnt >= r->length) {
//        return false;                  // 如果缓冲区满了，则返回错误
//    }
//    r->buf[r->tail] = data;
//    r->tail++;
//    r->fill_cnt++;
//    //计算tail是否超出数组范围，如果超出则自动切换到0
//    r->tail = r->tail % r->length;
//    return true;
//}

//int RingbufGut(struct Stdringbuf_n* r, uint8_t *c, uint16_t length) {
//    //当tail等于head时，说明队列空
//    if (r->fill_cnt<=0) {
//        return false;
//    }
//    //最多只能读取r->length长度数据
//    if (length > r->length) {
//        length = r->length;
//    }
//    
//    if(r->tail > r->head) {
//        if(r->tail < (length + r->head)) {
//            return false;
//        }
//    } else {
//        if( ((r->length-r->head)+r->tail) < length ) {
//            return false;
//        }
//    }
//    
//    int i;
//    for (i = 0; i<length; i++)
//    {
//        r->fill_cnt--;
//        *c = r->buf[r->head++];                 // 返回数据给*c
//        *c++;
//        //计算head自加后的下标是否超出数组范围，如果超出则自动切换到0
//        r->head = r->head % r->length;
//    }
//    return true;
//}

uint8_t  buf[50] = {0,};	//指向队列数组的指针
uint16_t length = 50;    //长度
uint16_t head = 0;      //队头
uint16_t tail = 0;      //队尾
int fill_cnt = 0;	//队列计数

int RingbufPut(uint8_t data) {
	if (fill_cnt >= length) {
		return false;   
	} else {
		buf[tail] = data;
		tail++;
		fill_cnt++;
		//计算tail是否超出数组范围，如果超出则自动切换到0
		tail = tail % length;
	}
	return true;
}

int RingbufGut(uint8_t *c, uint16_t leng) {
    //当tail等于head时，说明队列空
    if (fill_cnt<=0) {
        return false;
    }
    //最多只能读取r->length长度数据
    if (leng > length) {
        leng = length;
    }
    
    if(tail > head) {
        if(tail < (leng + head)) {
            return false;
        }
    } else {
        if( ((length-head)+tail) < leng ) {
            return false;
        }
    }
    
    int i;
    for (i = 0; i<leng; i++)
    {
        fill_cnt--;
        *c = buf[head++];                 // 返回数据给*c
        *c++;
        //计算head自加后的下标是否超出数组范围，如果超出则自动切换到0
        head = head % length;
    }
    return true;
}

/***************************************************************END OF FILE****/
